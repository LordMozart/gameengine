<html>
<head>
  <base href="https://cdn.jsdelivr.net/" />
  <title>3D Garfield Cube Game</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { width: 100%; height: 100%; display: block; }
    #instructions { position: absolute; top: 10px; left: 10px; color: white; background: linear-gradient(135deg, #ff6b2b, #ff8c42); padding: 10px; border-radius: 5px; font-family: Arial, sans-serif; }
    #healthUI { position: absolute; bottom: 20px; left: 20px; background: linear-gradient(135deg, #ff6b2b, #ff8c42); padding: 10px; border-radius: 5px; color: white; font-family: Arial, sans-serif; }
    #healthBar { width: 200px; height: 20px; background: #ff0000; border-radius: 10px; overflow: hidden; }
    #healthFill { width: 100%; height: 100%; background: #00ff00; transition: width 0.3s; }
    .enemyHealthContainer { position: absolute; transform: translate(-50%, -100%); background: linear-gradient(135deg, #ff6b2b, #ff8c42); padding: 5px; border-radius: 5px; color: white; font-family: Arial, sans-serif; pointer-events: none; }
    .enemyHealthBar { width: 100px; height: 10px; background: #ff0000; border-radius: 5px; overflow: hidden; }
    .enemyHealthFill { width: 100%; height: 100%; background: #ff0000; transition: width 0.3s; }
    #crosshair { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 24px; display: none; pointer-events: none; }
    #playerList { position: absolute; top: 10px; right: 10px; background: linear-gradient(135deg, #ff6b2b, #ff8c42); padding: 10px; border-radius: 5px; color: white; font-family: Arial, sans-serif; min-width: 200px; display: none; }
    #playerList.active { display: block; }
    .player-item { margin: 5px 0; display: flex; align-items: center; gap: 10px; }
  </style>
</head>
<body>
  <audio id="backgroundMusic" loop>
    <source src="/The Garfield Show.mp3" type="audio/mpeg">
  </audio>
  <div id="instructions">
    Use WASD to move<br>
    Arrow keys to look around<br>
    Space to jump<br>
    Press E to shoot fish<br>
    Avoid enemy fish!
  </div>
  <div id="healthUI">Health: <span id="healthText">100</span>
    <div id="healthBar">
      <div id="healthFill"></div>
    </div>
  </div>
  <div id="crosshair">+</div>
  <div id="playerList" class="active">
    <h3>Online Players</h3>
    <div id="playerListContent"></div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
    // Initialize essential variables
    const textureLoader = new THREE.TextureLoader();
    const room = new WebSocket("ws://your-server-url"); // Replace with your WebSocket URL
    let playerHealth = 100;
    const gravity = -0.01;
    const jumpForce = 0.3;
    let velocity = 0;
    let isJumping = false;
    const moveSpeed = 0.1;
    const scene = new THREE.Scene();

    // Set up skybox
    const skyGeometry = new THREE.BoxGeometry(1000, 1000, 1000);
    const skyTexture = textureLoader.load('/clearance.jpg');
    skyTexture.colorSpace = THREE.SRGBColorSpace;
    const skyMaterial = new THREE.MeshBasicMaterial({ map: skyTexture, side: THREE.BackSide });
    const skybox = new THREE.Mesh(skyGeometry, skyMaterial);
    scene.add(skybox);

    // Initialize camera
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(0, 5, 5); // Position the camera above the player
    camera.lookAt(0, 0, 0); // Ensure the camera is looking at the origin

    // Initialize renderer
    const renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Create player object
    const texture = textureLoader.load('/pngimg.com - garfield_PNG19.png');
    const geometry = new THREE.BoxGeometry(1, 1, 1);
    const material = new THREE.MeshBasicMaterial({ map: texture });
    const player = new THREE.Mesh(geometry, material);
    player.userData.direction = new THREE.Vector3(0, 0, -1);
    scene.add(player);

    // Add ground to the scene
    const groundGeometry = new THREE.PlaneGeometry(100, 100);
    const groundMaterial = new THREE.MeshBasicMaterial({ color: 0x228B22, side: THREE.DoubleSide });
    const ground = new THREE.Mesh(groundGeometry, groundMaterial);
    ground.rotation.x = Math.PI / 2;
    ground.position.y = -1;
    scene.add(ground);

    // Create enemies
    const enemies = [];
    const numberOfEnemies = 3;
    const enemyTexture = textureLoader.load('/IMG_1349.jpeg');

    function createEnemy() {
      const enemyGeometry = new THREE.BoxGeometry(1, 1, 1);
      const enemyMaterial = new THREE.MeshBasicMaterial({ map: enemyTexture });
      const enemy = new THREE.Mesh(enemyGeometry, enemyMaterial);
      enemy.position.set(Math.random() * 40 - 20, 0, Math.random() * 40 - 20);
      enemy.userData.health = 100;
      scene.add(enemy);
      enemies.push(enemy);
    }

    for (let i = 0; i < numberOfEnemies; i++) {
      createEnemy();
    }

    // Initialize controls and key listeners
    const keys = {};
    window.addEventListener('keydown', (event) => { keys[event.key] = true; });
    window.addEventListener('keyup', (event) => { keys[event.key] = false; });

    // Handle player movement and jumping
    function handlePlayerMovement() {
      if (keys['ArrowLeft']) player.rotation.y += 0.05;
      if (keys['ArrowRight']) player.rotation.y -= 0.05;
      if (keys['ArrowUp']) player.position.z -= moveSpeed;
      if (keys['ArrowDown']) player.position.z += moveSpeed;
      if (keys['w']) player.position.x += moveSpeed;
      if (keys['s']) player.position.x -= moveSpeed;
      if (keys[' ']) {
        if (!isJumping) {
          isJumping = true;
          velocity = jumpForce;
        }
      }
    }

    // Update health UI (for player)
    function updateHealthUI() {
      const healthBar = document.getElementById('healthBar');
      const healthFill = document.getElementById('healthFill');
      healthFill.style.width = `${playerHealth}%`;
      document.getElementById('healthText').innerText = `${playerHealth}`;
    }

    // Animation loop for the game
    function animate() {
      requestAnimationFrame(animate);
      handlePlayerMovement();

      // Handle gravity and jumping
      if (isJumping) {
        player.position.y += velocity;
        velocity += gravity;
        if (player.position.y <= 0) {
          player.position.y = 0;
          isJumping = false;
        }
      }

      // Render the scene
      renderer.render(scene, camera);
    }

    animate(); // Start the animation loop

    // Resize the renderer and update the camera aspect ratio when the window is resized
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>

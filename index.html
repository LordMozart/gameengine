<html>
<head>
  <base href="." />
  <meta charset="UTF-8">
  <title>Top Down 3D Shooter with Upgrades</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: Arial, sans-serif;
      background: #000;
    }
    #gameCanvas {
      width: 100vw;
      height: 100vh;
    }
    #hud {
      position: fixed;
      top: 20px;
      left: 20px;
      color: #fff;
      font-size: 24px;
      text-shadow: 2px 2px 2px #000;
    }
    #healthBar {
      width: 200px;
      height: 20px;
      background: #333;
      margin-top: 10px;
    }
    #health {
      width: 100%;
      height: 100%;
      background: #ff3333;
      transition: width 0.3s;
    }
    #killCount {
      margin-top: 10px;
    }
    #leaderboard {
      position: fixed;
      top: 50%;
      right: 20px;
      color: #fff;
      font-size: 24px;
      text-shadow: 2px 2px 2px #000;
      padding: 10px;
      background-color: rgba(0, 0, 0, 0.7);
      border-radius: 5px;
    }
    #upgradeBar {
      position: fixed;
      top: 50%;
      left: 20px;
      width: 20px;
      height: 300px;
      background-color: #444;
      border-radius: 5px;
      cursor: pointer;
    }
    #upgradeMenu {
      position: fixed;
      top: 50%;
      left: 100px;
      width: 200px;
      background-color: rgba(0, 0, 0, 0.8);
      padding: 10px;
      display: none;
      border-radius: 5px;
      box-shadow: 0 0 10px #fff;
    }
    .upgradeButton {
      width: 100%;
      padding: 10px;
      background-color: #222;
      color: #fff;
      margin-bottom: 5px;
      cursor: pointer;
      border: none;
      border-radius: 5px;
    }
    .upgradeButton:hover {
      background-color: #555;
    }
  </style>
</head>
<body>
  <div id="hud">
    Score: <span id="score">0</span>
    <div id="healthBar"><div id="health"></div></div>
    <div id="killCount">Kills: <span id="killCountValue">0</span></div>
  </div>
  <canvas id="gameCanvas"></canvas>

  <div id="upgradeBar"></div>
  <div id="upgradeMenu">
    <button class="upgradeButton" id="upgradeSpeed">Speed - Cost: 1000</button>
    <button class="upgradeButton" id="upgradeHealth">Health - Cost: 200</button>
    <button class="upgradeButton" id="upgradeDamage">Damage - Cost: 150</button>
    <button class="upgradeButton" id="closeMenu">Close</button>
  </div>
  <div id="leaderboard">
    <div>High Score: <span id="highScore">0</span></div>
    <div>High Kills: <span id="highKills">0</span></div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({
      canvas: document.getElementById('gameCanvas'),
      antialias: true
    });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;

    // Lighting
    const ambientLight = new THREE.AmbientLight(0x404040);
    scene.add(ambientLight);

    const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
    directionalLight.position.set(5, 5, 5);
    directionalLight.castShadow = true;
    scene.add(directionalLight);

    // Ground with Garfield texture
    const groundGeometry = new THREE.PlaneGeometry(50, 50);
    const groundTexture = new THREE.TextureLoader().load('garfield.png'); // Make sure 'garfield.png' is in the correct directory
    const groundMaterial = new THREE.MeshPhongMaterial({ map: groundTexture });
    const ground = new THREE.Mesh(groundGeometry, groundMaterial);
    ground.rotation.x = -Math.PI / 2;
    ground.position.y = -0.5;
    ground.receiveShadow = true;
    scene.add(ground);

    // Player
    const playerGeometry = new THREE.BoxGeometry(1, 1, 1);
    const playerMaterial = new THREE.MeshPhongMaterial({color: 0x00ff00});
    const player = new THREE.Mesh(playerGeometry, playerMaterial);
    player.position.y = 0.5;
    player.castShadow = true;
    player.receiveShadow = true;
    scene.add(player);

    // Game state
    let score = 0;
    let health = 100;
    let kills = 0;
    let enemies = [];
    const enemySpeed = 0.05;
    camera.position.set(0, 20, 0);
    camera.lookAt(0, 0, 0);

    // Upgrade system
    let gamePaused = false;
    let shootingSpeed = 0.65;
    let upgradeCosts = {
      speed: 1000,
      health: 200,
      damage: 150
    };
    let upgradeMultipliers = {
      speed: 0.9, // 10% speed increase
      health: 1.25, // 25% health increase
      damage: 1.2 // 20% damage increase
    };

    // Leaderboard - Load and display highest score/kills
    const loadLeaderboard = () => {
      const highScore = localStorage.getItem('highScore') || 0;
      const highKills = localStorage.getItem('highKills') || 0;
      document.getElementById('highScore').textContent = highScore;
      document.getElementById('highKills').textContent = highKills;
    };
    loadLeaderboard();

    // Game functions
    function togglePause() {
      gamePaused = !gamePaused;
      if (gamePaused) {
        document.getElementById('upgradeMenu').style.display = 'block';
        cancelAnimationFrame(animationId);
      } else {
        document.getElementById('upgradeMenu').style.display = 'none';
        animate();
      }
    }

    // Add event listener to the upgrade bar
    document.getElementById('upgradeBar').addEventListener('click', togglePause);

    // Upgrade handling
    function applyUpgrade(upgrade) {
      if (score >= upgradeCosts[upgrade]) {
        score -= upgradeCosts[upgrade];
        document.getElementById('score').textContent = score;
        
        // Apply the upgrade
        if (upgrade === 'speed') {
          shootingSpeed *= 0.9; // Speed upgrade reduces delay
          upgradeCosts[upgrade] *= 1.25; // Increase cost for next upgrade
          document.getElementById('upgradeSpeed').textContent = `Speed - Cost: ${Math.round(upgradeCosts[upgrade])}`;
        } else if (upgrade === 'health') {
          health += 10 * upgradeMultipliers[upgrade]; // Increase health by 25%
          document.getElementById('health').style.width = health + '%';
          upgradeCosts[upgrade] *= 1.25;
          document.getElementById('upgradeHealth').textContent = `Health - Cost: ${Math.round(upgradeCosts[upgrade])}`;
        } else if (upgrade === 'damage') {
          upgradeCosts[upgrade] *= 1.25;
          document.getElementById('upgradeDamage').textContent = `Damage - Cost: ${Math.round(upgradeCosts[upgrade])}`;
        }
      }
    }

    // Button actions
    document.getElementById('upgradeSpeed').addEventListener('click', () => applyUpgrade('speed'));
    document.getElementById('upgradeHealth').addEventListener('click', () => applyUpgrade('health'));
    document.getElementById('upgradeDamage').addEventListener('click', () => applyUpgrade('damage'));
    document.getElementById('closeMenu').addEventListener('click', togglePause);

    // Enemy creation
    function createEnemy() {
      const enemyGeometry = new THREE.BoxGeometry(1, 1, 1);
      const enemyMaterial = new THREE.MeshPhongMaterial({color: 0xff0000});
      const enemy = new THREE.Mesh(enemyGeometry, enemyMaterial);
      enemy.position.set(Math.random() * 10 - 5, 0.5, Math.random() * 10 - 5);
      enemy.castShadow = true;
      enemy.receiveShadow = true;
      enemies.push(enemy);
      scene.add(enemy);
    }

    // Game loop
    function animate() {
      if (gamePaused) return;
      requestAnimationFrame(animate);

      // Player movement
      const speed = 0.1;
      if (keyState['ArrowUp']) player.position.z -= speed;
      if (keyState['ArrowDown']) player.position.z += speed;
      if (keyState['ArrowLeft']) player.position.x -= speed;
      if (keyState['ArrowRight']) player.position.x += speed;

      // Enemy movement
      enemies.forEach(enemy => {
        enemy.position.x += enemySpeed;
        enemy.position.z += enemySpeed;
        if (enemy.position.x > 10 || enemy.position.x < -10 || enemy.position.z > 10 || enemy.position.z < -10) {
          scene.remove(enemy);
        }
      });

      renderer.render(scene, camera);
    }

    // Start game
    setInterval(createEnemy, 1000);

    // Player key states
    const keyState = {};
    window.addEventListener('keydown', e => keyState[e.key] = true);
    window.addEventListener('keyup', e => keyState[e.key] = false);

  </script>
</body>
</html>

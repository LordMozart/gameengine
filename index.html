<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Top-Down 3D Shooter</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
    // Set up the game scene
    const canvas = document.getElementById('gameCanvas');
    const renderer = new THREE.WebGLRenderer({ canvas });
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const clock = new THREE.Clock();

    // Game variables
    let player, bullets = [], enemies = [], score = 0, wave = 1;
    let keys = { w: false, a: false, s: false, d: false, space: false };

    // Player setup
    function createPlayer() {
      const geometry = new THREE.BoxGeometry(1, 1, 1);
      const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
      player = new THREE.Mesh(geometry, material);
      player.position.set(0, 0, 0);
      scene.add(player);
    }

    // Bullet setup
    function createBullet() {
      const geometry = new THREE.SphereGeometry(0.1, 8, 8);
      const material = new THREE.MeshBasicMaterial({ color: 0xff0000 });
      const bullet = new THREE.Mesh(geometry, material);
      bullet.velocity = new THREE.Vector3(0, 0, -1);
      bullet.position.set(player.position.x, player.position.y, player.position.z);
      bullets.push(bullet);
      scene.add(bullet);
    }

    // Enemy setup
    function createEnemy() {
      const geometry = new THREE.BoxGeometry(1, 1, 1);
      const material = new THREE.MeshBasicMaterial({ color: 0xff0000 });
      const enemy = new THREE.Mesh(geometry, material);
      enemy.position.set(Math.random() * 20 - 10, Math.random() * 20 - 10, 0);
      enemies.push(enemy);
      scene.add(enemy);
    }

    // Movement functions
    function handleMovement() {
      if (keys.w) player.position.z -= 0.1;
      if (keys.s) player.position.z += 0.1;
      if (keys.a) player.position.x -= 0.1;
      if (keys.d) player.position.x += 0.1;
    }

    // Bullet movement and collision
    function updateBullets() {
      for (let i = bullets.length - 1; i >= 0; i--) {
        bullets[i].position.add(bullets[i].velocity);
        // Check collision with enemies
        for (let j = enemies.length - 1; j >= 0; j--) {
          if (bullets[i].position.distanceTo(enemies[j].position) < 1) {
            enemies.splice(j, 1);
            scene.remove(enemies[j]);
            bullets.splice(i, 1);
            scene.remove(bullets[i]);
            score += 10;
            break;
          }
        }
      }
    }

    // Enemy movement (simple AI)
    function updateEnemies() {
      for (let enemy of enemies) {
        enemy.position.z += Math.random() * 0.2 - 0.1;
        enemy.position.x += Math.random() * 0.2 - 0.1;
      }
    }

    // Wave system
    function nextWave() {
      wave++;
      for (let i = 0; i < wave * 2; i++) {
        createEnemy();
      }
    }

    // Game loop
    function gameLoop() {
      const delta = clock.getDelta();
      handleMovement();
      updateBullets();
      updateEnemies();

      // Check for wave transition
      if (enemies.length === 0) {
        nextWave();
      }

      // Update the camera position
      camera.position.set(player.position.x, player.position.y, 10);
      camera.lookAt(player.position);

      renderer.render(scene, camera);
      requestAnimationFrame(gameLoop);
    }

    // Event listeners for player controls
    window.addEventListener('keydown', (e) => {
      if (e.key === 'w') keys.w = true;
      if (e.key === 'a') keys.a = true;
      if (e.key === 's') keys.s = true;
      if (e.key === 'd') keys.d = true;
      if (e.key === ' ') keys.space = true;
    });

    window.addEventListener('keyup', (e) => {
      if (e.key === 'w') keys.w = false;
      if (e.key === 'a') keys.a = false;
      if (e.key === 's') keys.s = false;
      if (e.key === 'd') keys.d = false;
      if (e.key === ' ') keys.space = false;
    });

    // Start the game
    createPlayer();
    gameLoop();
  </script>
</body>
</html>

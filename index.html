<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3D FPS Game</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; }
    #crosshair {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 10px;
      height: 10px;
      background: red;
      transform: translate(-50%, -50%);
      border-radius: 50%;
    }
    #hud {
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      font-family: Arial, sans-serif;
    }
  </style>
</head>
<body>
  <div id="crosshair"></div>
  <div id="hud">Health: <span id="playerHealth">100</span> | Score: <span id="score">0</span></div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/110/three.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r110/examples/js/loaders/GLTFLoader.js"></script>
  <script>
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const playerHealthElement = document.getElementById("playerHealth");
    const scoreElement = document.getElementById("score");

    let playerHealth = 100;
    let score = 0;

    const keys = {};
    let isJumping = false;
    let velocityY = 0;
    const gravity = -0.01;

    document.addEventListener('keydown', (e) => keys[e.key] = true);
    document.addEventListener('keyup', (e) => keys[e.key] = false);

    const playerSpeed = 0.1;
    const jumpSpeed = 0.3;

    // Player movement logic
    function handlePlayerMovement() {
      const forward = new THREE.Vector3();
      const right = new THREE.Vector3();

      camera.getWorldDirection(forward);
      forward.y = 0;
      forward.normalize();

      right.crossVectors(forward, camera.up).normalize();

      const newPosition = camera.position.clone();

      if (keys['w']) newPosition.addScaledVector(forward, playerSpeed);
      if (keys['s']) newPosition.addScaledVector(forward, -playerSpeed);
      if (keys['a']) newPosition.addScaledVector(right, -playerSpeed);
      if (keys['d']) newPosition.addScaledVector(right, playerSpeed);

      velocityY += gravity;
      newPosition.y += velocityY;

      if (newPosition.y < 1) {
        newPosition.y = 1;
        velocityY = 0;
        isJumping = false;
      }

      newPosition.clamp(
        new THREE.Vector3(-50, 1, -50),
        new THREE.Vector3(50, 10, 50)
      );

      camera.position.copy(newPosition);
    }

    // Pointer Lock for mouse control
    document.body.addEventListener('click', () => {
      document.body.requestPointerLock();
    });

    let yaw = 0;
    document.addEventListener('mousemove', (event) => {
      if (document.pointerLockElement === document.body) {
        yaw -= event.movementX * 0.002;
        camera.rotation.set(0, yaw, 0);
      }
    });

    // Skybox with color fallback
    const skyTexture = new THREE.TextureLoader().load('garfield.png', () => {
      console.log("Skybox loaded!");
    }, undefined, (error) => {
      console.error("Skybox load failed", error);
      scene.background = new THREE.Color(0x87ceeb); // Default color if texture fails
    });

    // Floor and box setup
    const floorGeometry = new THREE.PlaneGeometry(200, 200);
    const floorMaterial = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
    const floor = new THREE.Mesh(floorGeometry, floorMaterial);
    floor.rotation.x = -Math.PI / 2;
    scene.add(floor);

    const boxes = [];
    const boxTexture = new THREE.TextureLoader().load('garfield.png', () => {
      console.log("Box texture loaded!");
    });

    for (let i = 0; i < 10; i++) {
      const boxGeometry = new THREE.BoxGeometry(2, 2, 2);
      const boxMaterial = new THREE.MeshBasicMaterial({ map: boxTexture });
      const box = new THREE.Mesh(boxGeometry, boxMaterial);
      box.position.set(Math.random() * 80 - 40, 1, Math.random() * 80 - 40);
      scene.add(box);
      boxes.push(box);
    }

    // Loading gun model
    const gunGroup = new THREE.Group();
    const loader = new THREE.GLTFLoader();

    loader.load('scene.gltf', (gltf) => {
      console.log("Gun model loaded!");
      const gun = gltf.scene;
      gun.scale.set(0.5, 0.5, 0.5);
      gun.position.set(1.5, -0.5, -3);
      gunGroup.add(gun);
      camera.add(gunGroup);
    }, undefined, (error) => {
      console.error("Gun model load failed", error);
    });

    // Game loop
    function animate() {
      requestAnimationFrame(animate);
      handlePlayerMovement();
      renderer.render(scene, camera);
    }

    animate();
  </script>
</body>
</html>
